<Window x:Class="ClientWPFApplication.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModel="clr-namespace:ClientWPFApplication.ViewModels"
        xmlns:local="clr-namespace:ClientWPFApplication"
        mc:Ignorable="d"
        Title="MainWindow" Height="550" Width="800"
        x:Name="MainWindowControl"
        WindowStartupLocation="Manual"
        Top="0" Left="300">
    <Window.DataContext>
        <viewModel:MainWindowViewModel/>
    </Window.DataContext>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="3*" />
            <RowDefinition Height="3*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock Text="Available Models"
                   FontSize="16" FontWeight="Bold" Margin="0,0,0,5"/>

        <!-- MODELS LIST -->
        <DataGrid x:Name="ModelsGrid"
                  Grid.Row="1"
                  ItemsSource="{Binding Models}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionChanged="ModelsGrid_SelectionChanged"
                  Loaded="ModelsGrid_Loaded"
                  IsReadOnly="True"
                  SelectedItem="{Binding SelectedModel, Mode=TwoWay}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>
                <DataGridTextColumn Header="Model Name" Binding="{Binding ModelName}" Width="*"/>
                <DataGridTextColumn Header="Brand" Binding="{Binding BrandName}" Width="*"/>
                <DataGridTextColumn Header="Body Type" Binding="{Binding BodyType}" Width="Auto"/>
                <DataGridTextColumn Header="Doors" Binding="{Binding NumberOfDoors}" Width="Auto"/>
                <DataGridTextColumn Header="State" Binding="{Binding StateName}" Width="Auto"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- POPUP FOR ENGINE LIST -->
        <Popup PlacementTarget="{Binding ElementName=MainWindowControl}" 
               Placement="Bottom"
               x:Name="EnginePopup"
               IsOpen="True">
            
            <Border Background="White" BorderBrush="Black" BorderThickness="1" Padding="10" CornerRadius="8"
                    Width="800">
                <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="Engines" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <DataGrid ItemsSource="{Binding SelectedModel.ViableEngines}"
                              AutoGenerateColumns="False"
                              x:Name="EnginesGrid"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              MinWidth="400" MinHeight="150">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Configuration" Binding="{Binding Configuration}" Width="*"/>
                            <DataGridTextColumn Header="Fuel" Binding="{Binding Fuel}" Width="Auto"/>
                            <DataGridTextColumn Header="Cylinders" Binding="{Binding NumberOfCylinders}" Width="Auto"/>
                            <DataGridTextColumn Header="Power (kW)" Binding="{Binding Power}" Width="Auto"/>
                            <DataGridTextColumn Header="Torque (Nm)" Binding="{Binding Torque}" Width="Auto"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
        </Popup>
        <StackPanel Grid.Row="2" Orientation="Vertical" Margin="10" Width="300">
            <TextBlock Text="Add / Edit Model" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>

            <!-- Id -->
            <StackPanel Orientation="Horizontal" Margin="0,2">
                <TextBlock Text="Id:" Width="100"/>
                <TextBox Text="{Binding NewModel.Id, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Width="150"/>
            </StackPanel>

            <!-- Model Name -->
            <StackPanel Orientation="Horizontal" Margin="0,2">
                <TextBlock Text="Model Name:" Width="100"/>
                <TextBox Text="{Binding NewModel.ModelName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Width="150"/>
            </StackPanel>

            <!-- Brand Name -->
            <StackPanel Orientation="Horizontal" Margin="0,2">
                <TextBlock Text="Brand Name:" Width="100"/>
                <TextBox Text="{Binding NewModel.BrandName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Width="150"/>
            </StackPanel>

            <!-- Body Type -->
            <StackPanel Orientation="Horizontal" Margin="0,2">
                <TextBlock Text="Body Type:" Width="100"/>
                <ComboBox ItemsSource="{Binding BodyTypes}" 
                  SelectedItem="{Binding NewModel.BodyType, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                  Width="150"/>
            </StackPanel>

            <!-- Number of Doors -->
            <StackPanel Orientation="Horizontal" Margin="0,2">
                <TextBlock Text="Doors:" Width="100"/>
                <TextBox Text="{Binding NewModel.NumberOfDoors, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Width="150"/>
            </StackPanel>
        </StackPanel>
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="5">
            <Button Content="Add" Command="{Binding AddModelCommand}" Width="50" Margin="5"/>
            <Button Content="Update" Command="{Binding UpdateModelCommand}" Width="50" Margin="5" />
            <Button Content="Delete" Command="{Binding DeleteModelCommand}" Width="50" Margin="5"/>
            <Button Content="Undo" Command="{Binding UndoCommand}" Width="50" Margin="5"/>
            <Button Content="Redo" Command="{Binding RedoCommand}" Width="50" Margin="5"/>
            <Button Content="Search" Command="{Binding SearchCommand}" Width="50" Margin="5"/>
            <Button Content="Reset" Command="{Binding ResetSearchCommand}" Width="50" Margin="5"/>
        </StackPanel>
    </Grid>
</Window>
